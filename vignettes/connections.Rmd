---
title: "stream: Working With Data Streams Over Connections"
author: "Michael Hahsler"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{stream: Working With Data Streams Over Connections}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

`stream` can use the functions `write_stream()` and the class `DSD_ReadCSV` for communicate via connections. Here is 
a short example of how to set up this communication.

## Serving stream data

We use library `callr` to create a separate R process that serves a data stream using a socket connection, but
you can also put the code in a file called `server.R` and run it with `R CMD BATCH server.R` from the command line.

```{r eval = FALSE}
library(callr)

rp1 <- r_bg(function() {
  library(stream)
  stream <- DSD_Gaussians(k = 3, d = 3)
  blocksize <- 100

  con <- socketConnection(port = 6011, server = TRUE)
  
  while (TRUE)
    write_stream(stream, con, n = blocksize, close = FALSE)
  close(con)
})

rp1
```

## Reading from the stream

```{r eval = FALSE}
library(stream)

con <- socketConnection(port = 6011, open = 'r')
con

dsd <- DSD_ReadStream(con)
get_points(dsd, n= 20, outofpoints = "ignore")

close(con)
```

## Cleaning up the server process

```{r eval = FALSE}
rp1$kill()
rp1
```

